<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/css/gradebook.css">
</head>
<body>
    <div class="container">
        <div class="top d-flex justify-content-between">
            <h1>Gradebook</h1>
            <div class="search-container">
                <div class="input-wrapper">
                    <img src="/img/search 1.svg" alt="Search" class="search-icon"> 
                    <input type="text" class="search-input" placeholder="Search">
                </div>
            </div>
            <img src="/img/Ava.svg" alt="User" class="user-avatar"> 
            <div class="user">
                <h3>Veronica</h3>
                <p>Admin</p>
            </div>
        </div>
        <div class="d-flex ">
                    <button class="excel mr-3">
                        <img src="/img/file-excel (1).png" alt="Excel File Export">
                        Excel Export
                    </button>
                    <button class="pdf">
                        <img src="/img/file-pdf (1).png" alt="PDF File Export">
                        PDF Export
                    </button>
                    <button id="saveButton" class="edit ml-auto">
                        <img src="/img/edit.png" alt="Edit">
                        Save
                    </button>
        </div>
        <div class="scroll-area mt-3">
            <div class="">
                <table class="table">
                    <thead>
                        <tr>
                            <th colspan="6">SCHOOL YEAR - SEMESTER 2</th>
                            <th colspan="6">SUBJECT: MATH - CLASS 6A.1</th>
                        </tr>
                        <tr>
                            <th>STT</th>
                            <th class="teacher-header">Họ và tên</th>
                            <th colspan="4">Hệ số 1</th>
                            <th colspan="2">Hệ số 2</th>
                            <th>HK</th>
                            <th>TBM</th>
                            <th>HK1</th>
                            <th>CN</th>
                        </tr>
                    </thead>
                    <!--START THE GRADEBOOK -->
                    <tbody class="scroll-content">
                        {{#each combinedData}}
                        <tr data-grade-id="{{this.GradeID}}">
                            <td>{{@index}}</td>
                            <td class="name-cell">{{this.Name}}</td>
                            <td><input type="text" name="HS11" value="{{this.HS11}}"></td>
                            <td><input type="text" name="HS12" value="{{this.HS12}}"></td>
                            <td><input type="text" name="HS13" value="{{this.HS13}}"></td>
                            <td><input type="text" name="HS14" value="{{this.HS14}}"></td>
                            <td><input type="text" name="HS21" value="{{this.HS21}}"></td>
                            <td><input type="text" name="HS22" value="{{this.HS22}}"></td>
                            <td><input type="text" name="HS3" value="{{this.HS3}}"></td>
                            <td><input type="text" name="Average" value="{{this.Average}}"></td>
                            <td><input type="text" name="HK1" value="{{this.HK1}}"></td>
                            <td><input type="text" name="CN" value="{{this.CN}}"></td>
                        </tr>
                        {{/each}}
                    </tbody>
                    <script>
                        document.getElementById('saveButton').addEventListener('click', function() {
                        const gradeInputs = document.querySelectorAll('.scroll-content tr');
                        const gradesData = Array.from(gradeInputs).map(row => {
                            const cells = row.querySelectorAll('input');
                            return {
                                gradeId: row.getAttribute('data-grade-id'),
                                hs11: cells[0].value,
                                hs12: cells[1].value,
                                hs13: cells[2].value,
                                hs14: cells[3].value,
                                hs21: cells[4].value,
                                hs22: cells[5].value,
                                hs3: cells[6].value,
                                Average: cells[7].value,
                                // và các trường dữ liệu khác...
                            };
                        });
                        console.log("A:", gradesData);
                        fetch('./grade/update', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(gradesData)
                        })
                        .then(response => response.json()
                            )
                        .then(data => {
                            console.log('Success:', data);
                        })
                        .catch((error) => {
                            console.error('Loi:', error);
                        });
                    });
                    </script>

                    <script>
                        document.addEventListener('DOMContentLoaded', function () {
                            const indexCells = document.querySelectorAll('.scroll-content tr td:first-child');
                            indexCells.forEach((cell, index) => {
                                cell.textContent = index + 1; // Tăng index bắt đầu từ 1
                            });
                        });
                    </script>
                </table>
            </div>
        </div>

    </div>
</body>